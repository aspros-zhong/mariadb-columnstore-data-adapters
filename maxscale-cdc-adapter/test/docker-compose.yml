---
version: '2'
services:
  maxscale:
    build: maxscale
    depends_on:
      - mariadb1 
      - mariadb2 
      - mariadb3 
    command: maxscale -d -l stdout
    ports:
      - "13306:13306"
      - "13307:13307"
      - "8003:8003"
      - "9003:9003"
      - "4001:4001"

  mariadb1:
    image: mariadb
    build: mariadb
    command: --log-bin --skip-name-resolve --server_id=1 --sync_binlog=1 --innodb_flush_log_at_trx_commit=1 --binlog_format=row --binlog_row_image=full
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_INITDB_SKIP_TZINFO=true
    ports:
      - "14306:3306"

  mariadb2:
    image: mariadb
    command: --log-bin --skip-name-resolve --server_id=2 --sync_binlog=1 --innodb_flush_log_at_trx_commit=1  --port=3307 --binlog_format=row --binlog_row_image=full
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_INITDB_SKIP_TZINFO=true
    ports:
      - "14307:3307"

  mariadb3:
    image: mariadb
    command: --log-bin --skip-name-resolve --server_id=3 --sync_binlog=1 --innodb_flush_log_at_trx_commit=1 --port=3308 --binlog_format=row --binlog_row_image=full
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_INITDB_SKIP_TZINFO=true
    ports:
      - "14308:3308"
  mxs_adapter:
    build: mxs_adapter
    ports:
      - "14310:3306"
  mcs:
    build: mcs
    ports:
      - "14309:3306"
  tester:
    build: tests
